<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    
    <title>{% block title %} {{ titlepage }}Dostourna{% endblock %}</title>
    <link rel="icon" href="{{asset('assets/images/site_logo/logotemp.png')}}" />
    {% block css %}
    <style>
      .modal {
          display: none;
          position: fixed;
          z-index: 1;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5); 
          justify-content: center;
          align-items: center;
      }

      .modal-content {
          background-color: white;
          width: 80%;
          max-width: 600px;
          border-radius: 10px;
          display: flex;
          padding: 20px;
          position: relative;
          box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      }

      .modal-body {
          display: flex;
      }

      .left-side {
          flex: 1;
          padding-right: 20px;
      }

      .left-side img {
          width: 100%;
          border-radius: 10px;
      }

      /* Right side content styling */
      .right-side {
          flex: 1;
      }

      .right-side h1 {
          font-size: 24px;
          margin-bottom: 10px;
      }

      .right-side p {
          margin-bottom: 10px;
      }

      #emailInput {
          width: 100%;
          padding: 10px;
          margin: 10px 0;
          border-radius: 5px;
          border: 1px solid #ccc;
      }

      #ctaButton {
          background-color: #f8a100;
          color: white;
          padding: 10px;
          border: none;
          width: 100%;
          font-size: 16px;
          cursor: pointer;
          border-radius: 5px;
      }

      .decline {
          text-align: center;
          color: #999;
          cursor: pointer;
          margin-top: 10px;
          font-size: 14px;
      }

      .close {
          position: absolute;
          top: 10px;
          right: 15px;
          font-size: 28px;
          cursor: pointer;
      }

      /* test */
      /* Modal background */
      .modal {
          display: none;
          position: fixed;
          z-index: 1;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5); /* Gray background with transparency */
          justify-content: center;
          align-items: center;
      }

      /* Modal content */
      .modal-content {
          background-color: white;
          width: 90%;
          max-width: 700px;
          border-radius: 15px;
          display: flex;
          padding: 20px;
          position: relative;
          box-shadow: 0 5px 15px rgba(0,0,0,0.3);
          animation: fadeIn 0.3s ease-in-out;
      }

      /* Fade in animation */
      @keyframes fadeIn {
          from { opacity: 0; transform: scale(0.9); }
          to { opacity: 1; transform: scale(1); }
      }

      /* Modal close button */
      .close {
          position: absolute;
          top: 15px;
          right: 20px;
          font-size: 28px;
          color: #333;
          cursor: pointer;
      }

      /* Modal body styling */
      .modal-body {
          display: flex;
          flex-wrap: wrap;
      }

      .left-side {
          flex: 1;
          padding-right: 20px;
      }

      .left-side img {
          width: 100%;
          border-radius: 10px;
      }

      /* Right side content */
      .right-side {
          flex: 1;
          text-align: left;
      }

      .right-side h2 {
          font-size: 24px;
          margin-bottom: 15px;
          color: #333;
      }

      .right-side p {
          margin-bottom: 20px;
          color: #666;
      }

      /* Payment container */
      .payment-container {
          background-color: #f9f9f9;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .payment-form {
          display: flex;
          flex-direction: column;
      }

      .card-element {
          background-color: white;
          padding: 15px;
          border-radius: 8px;
          border: 1px solid #ccc;
          margin-bottom: 20px;
      }

      .payment-button {
          background-color: #f8a100;
          color: white;
          padding: 10px;
          border: none;
          font-size: 18px;
          cursor: pointer;
          border-radius: 8px;
          transition: background-color 0.3s;
      }

      .payment-button:hover {
          background-color: #ff9800;
      }

      .payment-message {
          margin-top: 10px;
          font-size: 14px;
          color: #f44336;
          text-align: center;
      }
    </style>

    <!-- Fraimwork - CSS Include -->
    <link rel="stylesheet" href="{{ asset('assets/css/bootstrap.min.css') }}" type="text/css">
    <!-- Icon Font - CSS Include -->
    <link rel="stylesheet" href="{{ asset('assets/css/fontawesome.min.css') }}" type="text/css">
    <!-- Animation - CSS Include -->
    <link rel="stylesheet" href="{{ asset('assets/css/animate.min.css') }}" type="text/css">
    <!-- Cursor - CSS Include -->
    <link rel="stylesheet" href="{{ asset('assets/css/cursor.min.css') }}" type="text/css">
    <!-- Carousel - CSS Include -->
    <link rel="stylesheet" href="{{ asset('assets/css/slick.min.css') }}" type="text/css">
    <link rel="stylesheet" href="{{ asset('assets/css/slick-theme.min.css') }}" type="text/css">
    <!-- Video & Image Popup - CSS Include -->
    <link rel="stylesheet" href="{{ asset('assets/css/magnific-popup.min.css') }}" type="text/css">
    <!-- Counter - CSS Include -->
    <link rel="stylesheet" href="{{ asset('assets/css/odometer.min.css') }}" type="text/css">
    <!-- Custom - CSS Include -->
    <link rel="stylesheet" href="{{ asset('assets/css/style.css') }}" type="text/css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Include Stripe.js -->
    <script src="https://js.stripe.com/v3/"></script>

    {% endblock %}
</head>

  <body>
    <!-- Body Wrap - Start -->
    <div class="page_wrapper">
      <!-- Back To Top - Start -->
      <div class="backtotop">
        <a href="#" class="scroll">
          <i class="fa-solid fa-arrow-up"></i>
        </a>
      </div>
      <!-- Back To Top - End -->

      <!-- Site Header - Start
      ================================================== -->
      <header class="site_header">
        <div class="container">
          <div class="row align-items-center">
            <div class="col-lg-2 col-5">
              <div class="site_logo">
                <a class="site_link" href="{{ path('app_home') }}">
                  <img
                    src="{{asset('assets/images/site_logo/logotemp.png')}}"
                    alt="Logo"
                    width="150" height="150"
                  />
                </a>
              </div>
            </div>
            {# Navbar part  #}
            {% block Navbar %}
            
            <div class="col-lg-7 col-2">
                <nav class="main_menu navbar navbar-expand-lg">
                <div
                    class="main_menu_inner collapse navbar-collapse justify-content-center"
                    id="main_menu_dropdown"
                >
                    <ul class="main_menu_list unordered_list">
                    <li{% if (part==1)%}  class="active"{% endif %}>
                        <a class="nav-link" href="{{ path('app_home') }}"> <i class="fa fa-home" aria-hidden="true"></i> Accueil</a>
                    </li>
                    <li{% if (part==2)%}  class="active"{% endif %}>
                        <a class="nav-link" href="{{ path('app_about') }}"> <i class="fa-solid fa-book-open-reader"></i> Ã€ Propos </a>
                    </li>
                    <li{% if (part==3)%}  class="active"{% endif %}>
                        <a class="nav-link" href="{{ path('app_projects', {'cat': 0 ,'page':1}) }}"> <i class="fa-solid fa-rectangle-history-circle-plus"></i> Nos Projets </a>  
                    </li>
                     {# <li{% if (part==4)%}  class="active"{% endif %}>
                        <a class="nav-link" href="{{ path('app_home') }}"> <i class="fa-solid fa-coins"></i> Financement</a>  
                    </li> #}
                    {# <li{% if (part==4)%}  class="active"{% endif %}>
                        <a class="nav-link" href="{{ path('app_home') }}"> <i class="fa-solid fa-comments"></i> Contact</a>
                    </li> #}
                    </ul>
                </div>
                </nav>
            </div>

            {% endblock %}
            <div class="col-lg-3 col-5">
              <ul class="header_btns_group unordered_list justify-content-end">
                <li>
                  <button
                    class="mobile_menu_btn"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#main_menu_dropdown"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                  >
                    <i class="far fa-bars"></i>
                  </button>
                </li>
              {% if is_granted('IS_AUTHENTICATED_REMEMBERED') %}
                  <!-- Profile Dropdown for Logged-in Users -->
                  <ul class="main_menu_list unordered_list">
                  <li>
                  <a class="nav-link"  id="openModalBtn">
                  <i class="fa-duotone fa-solid fa-wallet"></i> {{ app.user.balance }} <i class="fa-light fa-bitcoin-sign"></i>
                  </a>
                  </li>
                  <li class="nav-item dropdown">
                      <a class="nav-link  dropdown-toggle d-flex justify-content-center items-align-center" id="navbarDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                         {{ app.user.lastName|capitalize }} {{ app.user.firstName|capitalize }}
                      </a>
                      <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                          <li><a class="dropdown-item" href="{{ path('app_user_profile')}}"><i class="fa-duotone fa-solid fa-user"></i>   Voir le profil</a></li>
                          <li><a class="dropdown-item" href="#"><i class="fa-duotone fa-solid fa-address-card"></i>   Modifier le profil</a></li>
                          <li><a class="dropdown-item" href="{{ path('app_user_logout') }}"><i class="fa-duotone fa-solid fa-right-from-bracket"></i>  DÃ©connexion</a></li>
                      </ul>
                  </li>
                  </ul>
                  <div id="popupModal" class="modal">
                    <div class="modal-content">
                        <span class="close">&times;</span>
                        <div class="modal-body">
                            <div class="left-side">
                                <img src="https://img.freepik.com/free-vector/pay-by-smart-phone-wallet-transaction-sending-digital-money-money-transferring-digitally-from-one-mobile-phone-another-vector-flat-illustration_1150-58768.jpg" alt="Product Image">
                            </div>
                            <div class="right-side">
                                <div class="payment-container">
                                  <input type="number" id="amount" class="card-element" placeholder="Montant" step="0.01" required>
                                  <form id="payment-form" class="payment-form">
                                      <div id="card-element" class="card-element">
                                      </div>
                                      <button id="submit" class="payment-button">Payer</button>
                                      <div id="payment-message" class="payment-message"></div>
                                  </form>
                                </div>
                            </div>
                        </div>
                    </div>
                  </div>

              {% else %}
                  <!-- Login Button for Guests -->
                  <li>
                    <a class="btn btn-primary" href="{{ path('app_user_login')}}">
                      <span class="btn_text" data-text="Maintenant ðŸ«¶">
                      Rejoignez-nous
                      </span>
                      <span class="btn_icon">
                        <i class="fa-solid fa-arrow-up-right"></i>
                      </span>
                    </a>
                  </li>
              {% endif %}
              </ul>
            </div>
          </div>
        </div>
      </header>
      <!-- Site Header - End
      ================================================== -->

      
      <!-- Main Body - Start
      ================================================== -->
      <main class="page_content ">
        <br>
        <br>
        <!-- Page Banner - Start
        ================================================== -->
        {% block pageBanner %}
        {%if (title!='')%}
        <section class="page_banner decoration_wrapper ">
          <div class="container ">
            <div class="row align-items-center">
              <div class="col-lg-6">
                <h1 class="page_title mb-0">{{ title }}</h1>
              </div>
              <div class="col-lg-6">
                <ul
                  class="breadcrumb_nav unordered_list justify-content-lg-end justify-content-center"
                >
                {% block pageBannerurlretour %}
                  <li><a href="{{ path('app_home') }}">Accueil</a></li>
                  <li>{{ title }}</li>
                  {% endblock %}
                </ul>
              </div>
            </div>
          </div>
          <div class="decoration_item shape_leaf_1">
            <img
              src="{{asset('assets/images/shapes/shape_leaf_left.svg')}}"
              alt="Shape Leaf - Talking Minds - Psychotherapist Site Template"
            />
          </div>
          <div class="decoration_item shape_leaf_2">
            <img
              src="{{asset('assets/images/shapes/shape_leaf_right.svg')}}"
              alt="Shape Leaf - Talking Minds - Psychotherapist Site Template"
            />
          </div>
        </section>
        <br>
        <br>
        {% endif %}
        {% endblock %}
        <!-- Page Banner - End
        ================================================== -->
       
        {% block body %}       
        {% endblock %}
      </main>
      <!-- Main Body - End
      ================================================== -->

      <!-- Site Footer - Start
      ================================================== -->
      <footer class="site_footer bg_primary  ">
        <div class="container ">
          <div class="site_footer_content">
            <div class="row align-items-center">
              <div class="col-lg-3">
                <div class="site_logo">
                  <a class="site_link" href="{{ path('app_home') }}">
                    <img
                      src="{{asset('assets/images/site_logo/logotemp.png')}}"
                      alt=" Logo"
                      width="200" height="200"
                    />
                  </a>
                </div>
              </div>
              <div class="col-lg-6">
                <ul class="info_list unordered_list justify-content-center" >
                  <li >
                    <a href="{{ path('app_home') }}" style="color: var(--bs-dark);">
                      <span class="info_icon">
                        <i class="fa-solid fa-circle"></i>
                      </span>
                      <span class="info_text" >Acceuil</span>
                    </a>
                  </li>
                  <li>
                    <a href="{{ path('app_about') }}" style="color: var(--bs-dark);">
                      <span class="info_icon">
                        <i class="fa-solid fa-circle"></i>
                      </span>
                      <span class="info_text">Ã€ Propos</span>
                    </a>
                  </li>
                  <li>
                    <a href="{{ path('app_projects', {'cat': 0 ,'page':1}) }}" style="color: var(--bs-dark);">
                      <span class="info_icon">
                        <i class="fa-solid fa-circle"></i>
                      </span>
                      <span class="info_text">Nos projets</span>
                    </a>
                  </li>
                  {# <li>
                    <a href="{{ path('app_home', {'page':1}) }}" style="color: var(--bs-dark);">
                      <span class="info_icon">
                        <i class="fa-solid fa-circle"></i>
                      </span>
                      <span class="info_text">Financement</span>
                    </a>
                  </li> #}
                  {# <li>
                    <a href="{{ path('app_home') }}" style="color: var(--bs-dark);">
                      <span class="info_icon">
                        <i class="fa-solid fa-circle"></i>
                      </span>
                      <span class="info_text">Contact</span>
                    </a>
                  </li> #}
                </ul>
              </div>
              <div class="col-lg-3">
                <ul
                  class="social_links unordered_list justify-content-center justify-content-lg-end"
                >
                  <li>
                    <a href="#!"><i class="fa-brands fa-facebook-f"></i></a>
                  </li>
                  <li>
                    <a href="#!"><i class="fa-brands fa-instagram"></i></a>
                  </li>
                  <li>
                    <a href="#!"><i class="fa-brands fa-twitter"></i></a>
                  </li>
                  <li>
                    <a href="#!"><i class="fa-brands fa-whatsapp"></i></a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="copyright_widget text-center">
            <p class="copyright_text m-0">
              <b>BinaryBots</b> Â© 2024 <b>DostournaChain</b> All rights reserved. 
            </p>
          </div>
        </div>
      </footer>
      <!-- Site Footer - End
      ================================================== -->
    </div>
    <!-- Body Wrap - End -->

    <!-- Fraimwork - Jquery Include -->
    <script src="{{ asset('assets/js/jquery.min.js') }}"></script>
    <script src="{{ asset('assets/js/popper.min.js') }}"></script>
    <script src="{{ asset('assets/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('assets/js/bootstrap-dropdown-ml-hack.min.js') }}"></script>

    <!-- animation - jquery include -->
    <script src="{{ asset('assets/js/cursor.min.js') }}"></script>
    <!-- Carousel - Jquery Include -->
    <script src="{{ asset('assets/js/slick.min.js') }}"></script>
    <!-- Video & Image Popup - Jquery Include -->
    <script src="{{ asset('assets/js/magnific-popup.min.js') }}"></script>
    <!-- Counter - Jquery Include -->
    <script src="{{ asset('assets/js/appear.min.js') }}"></script>
    <script src="{{ asset('assets/js/odometer.min.js') }}"></script>
    <!-- Custom - Jquery Include -->
    <script src="{{ asset('assets/js/main.js') }}"></script>

    <script>
      const stripe = Stripe('{{ stripe_public_key }}');
      const elements = stripe.elements();
      const cardElement = elements.create('card');
      cardElement.mount('#card-element');
  
      const form = document.getElementById('payment-form');
      const paymentMessage = document.getElementById('payment-message');
      const amountInput = document.getElementById('amount');
  
      form.addEventListener('submit', async (event) => {
          event.preventDefault();
  
          document.getElementById('submit').disabled = true;
          paymentMessage.textContent = "Payment en cours...";
  
          const amount = parseFloat(amountInput.value);
          if (isNaN(amount) || amount <= 0) {
              paymentMessage.textContent = "Veuillez saisir un montant valide .";
              document.getElementById('submit').disabled = false;
              return;
          }
  
          try {
              const response = await fetch('/create-payment-intent', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ amount: Math.round(amount * 100) }) // Convert to cents
              });
              const { clientSecret } = await response.json();
  
              const result = await stripe.confirmCardPayment(clientSecret, {
                  payment_method: { card: cardElement }
              });
  
              if (result.error) {
                  paymentMessage.textContent = result.error.message;
              } else if (result.paymentIntent.status === 'succeeded') {
                paymentMessage.textContent = "Transaction Valide!";
                window.location.href = '/payment-success?amount=' + amount;
              }
          } catch (error) {
              paymentMessage.textContent = "Une erreur s'est produite lors du traitement du paiement.";
              console.error(error);
          }
  
          document.getElementById('submit').disabled = false;
      });
    </script>
    <!-- Custom - Model popup -->
    <script>
      var modal = document.getElementById("popupModal");
      var btn = document.getElementById("openModalBtn");
      var span = document.getElementsByClassName("close")[0];
      btn.onclick = function() {
          modal.style.display = "flex";
      }
      span.onclick = function() {
          modal.style.display = "none";
      }
      window.onclick = function(event) {
          if (event.target == modal) {
              modal.style.display = "none";
          }
      }
    </script>
  </body>
</html>
